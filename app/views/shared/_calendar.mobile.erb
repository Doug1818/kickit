<!-- Required Alert -->
<% if current_user.program.supporters.empty? && !current_user.stripe_customer_id? %>
	<div class="required_alert">You need to <%= link_to "choose a supporter", supporters_path %> and <%= link_to "provide billing information", billing_user_path(current_user) %>.</div>
<% elsif current_user.program.supporters.empty? && current_user.stripe_customer_id? %>
	<div class="required_alert">You need to <%= link_to "choose a supporter", supporters_path %>.</div>
<% elsif current_user.program.supporters.any? && !current_user.stripe_customer_id? %>
	<div class="required_alert">You need to <%= link_to "provide billing information", billing_user_path(current_user) %>.</div>
<% end %>

<!-- Todays's Goal -->
<% if current_user.program.days.find_by_date(Date.current).goal? %>
	<h3 style="margin-bottom:0;">Today's Goal:</h3>
	<h4 style="margin-top:0;margin-bottom:10px;"><%= current_user.program.days.find_by_date(Date.current).goal %></h4>
<% end %>

<!-- Counters -->
<div class="ui-grid-a counters" style="margin:0 !important;">
	<div class="ui-block-a">
		<%= form_for @day, url: want_day_path(@day), html: { method: :put } do |f| %>
			<%= f.submit "Wanted To (#{@day.want_count})", "data-theme" => "d" %>
		<% end %>
	</div>
	<div class="ui-block-b">
		<%= form_for @day, url: did_day_path(@day), html: { method: :put } do |f| %>
			<%= f.submit "Did (#{@day.did_count})", "data-theme" => "d" %>
		<% end %>
	</div>
</div>

<!-- Calendar -->
<div id="calendar">
	<h3 id="month">
		<%= link_to "<", :month => (@today.beginning_of_month-1).strftime("%Y-%m-01") %>
		<%= h @today.strftime("%B %Y") %>
		<%= link_to ">", :month => (@today.end_of_month+1).strftime("%Y-%m-01") %>
	</h3>
	<%= calendar_for @days, :year => @today.year, :month => @today.month, :today => Date.current do |calendar| %>
		<%= calendar.head('Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat')%>
		<% calendar.day(:day_method => :date) do |date, days| %>
			<%= date.day %>
			<% for day in days %>
				| D<%= h(day.day) %>
				<div class="result">
					<% if day.result? %>
						<% if day.result == 1 %>
							<%= link_to image_tag("glyphicons_206_ok_2.png", size: "15x15"), day_path(day), "data-rel" => "dialog" %>
						<% elsif day.result == 2 %>
							<%= link_to image_tag("glyphicons_207_remove_2.png", size: "15x15"), day_path(day), "data-rel" => "dialog" %>
						<% elsif day.result == 3 %>
							<%= link_to image_tag("glyphicons_030_pencil.png", size: "15x15"), day_path(day), "data-rel" => "dialog" %>
						<% elsif day.result == 4 %>
							<%= link_to image_tag("glyphicons_196_circle_exclamation_mark.png", size: "15x15"), day_path(day), "data-rel" => "dialog" %>
						<% elsif day.result == 5 %>
							<%= link_to "FREE DAY", day_path(day), class: "free_day", "data-rel" => "dialog" %>
						<% end %>
					<% else %>
						<%= link_to image_tag("iconmonstr-help-icon.png", size: "20x20"), day_path(day), "data-rel" => "dialog" %>
					<% end %>
				</div>
			<% end %>
		<% end %>
	<% end %>
</div>

<!-- Dollar balance and Free Days balance -->
<div style="text-align:center;">
	<% if current_user.program.this_week.missed > 0 %>
		<h4 style="margin-top:5px;margin-bottom:5px;"><strong>
			$<%= current_user.program.this_week.missed*current_user.program.daily_commitment %> 
			lost</strong> from missed checkins</h4>
	<% end %>
	<% if current_user.program.this_week.free_days > 0 %>
		<h4 style="margin-top:5px;"><strong>
			<%= "#{current_user.program.free_days_left} #{'free day'.pluralize(current_user.program.free_days_left)}" %>
		</strong> left this week</h4>
	<% end %>
</div>